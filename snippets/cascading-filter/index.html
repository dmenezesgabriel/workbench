<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Company Data Table</title>
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }

      th,
      td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <form>
      <label for="filter-d1">Filter Dimension 1:</label>
      <select id="filter-d1" multiple>
        <!-- Add distinct dimension values dynamically using JavaScript -->
      </select>

      <label for="filter-d2">Filter Dimension 2:</label>
      <select id="filter-d2" multiple>
        <!-- Add distinct dimension values dynamically using JavaScript -->
      </select>

      <label for="filter-d3">Filter Dimension 3:</label>
      <select id="filter-d3" multiple>
        <!-- Add distinct dimension values dynamically using JavaScript -->
      </select>

      <label for="filter-d4">Filter Dimension 4:</label>
      <select id="filter-d4" multiple>
        <!-- Add distinct dimension values dynamically using JavaScript -->
      </select>
      <button id="reset-filters">Reset Filters</button>
    </form>
    <table>
      <thead>
        <tr>
          <th>Dimension 1</th>
          <th>Dimension 2</th>
          <th>Dimension 3</th>
          <th>Dimension 4</th>
          <th>Budget Measure 1</th>
          <th>Budget Measure 2</th>
        </tr>
      </thead>
      <tbody>
        <!-- Replace this section with your actual array of objects -->
        <script>
          var companyData = [
            {
              d1: "HR",
              d2: "Recruitment",
              d3: "Sourcing",
              d4: "Team A",
              budget1: 120000,
              budget2: 60000,
            },
            {
              d1: "HR",
              d2: "Recruitment",
              d3: "Sourcing",
              d4: "Team B",
              budget1: 100000,
              budget2: 55000,
            },
            {
              d1: "HR",
              d2: "Recruitment",
              d3: "Interviewing",
              d4: "Team A",
              budget1: 130000,
              budget2: 65000,
            },
            {
              d1: "HR",
              d2: "Recruitment",
              d3: "Interviewing",
              d4: "Team B",
              budget1: 110000,
              budget2: 60000,
            },
            {
              d1: "HR",
              d2: "Employee Relations",
              d3: "Conflict Resolution",
              d4: "Team A",
              budget1: 95000,
              budget2: 50000,
            },
            {
              d1: "HR",
              d2: "Employee Relations",
              d3: "Conflict Resolution",
              d4: "Team B",
              budget1: 90000,
              budget2: 48000,
            },
          ];

          class Filter {
            constructor(id) {
              this.element = document.getElementById(id);
            }

            getSelectedOptions() {
              return Array.from(
                this.element.selectedOptions,
                (option) => option.value
              );
            }

            addOption(option) {
              this.element.appendChild(new Option(option, option));
            }

            clearOptions() {
              this.element.innerHTML = "";
            }
          }

          class Table {
            constructor() {
              this.tbody = document.querySelector("tbody");
            }

            updateTable(data, filters) {
              const selectedFilters = filters.map((filter) =>
                filter.getSelectedOptions()
              );

              const filteredData = this.filterData(data, selectedFilters);

              this.renderTable(filteredData);
            }

            filterData(data, selectedFilters) {
              return data.filter((item) =>
                selectedFilters.every((selectedOptions, index) => {
                  return (
                    selectedOptions.length === 0 ||
                    selectedOptions.includes(item[`d${index + 1}`])
                  );
                })
              );
            }

            renderTable(data) {
              this.tbody.innerHTML = "";

              data.forEach(function (item) {
                const row = document.createElement("tr");
                row.innerHTML = `
                  <td>${item.d1}</td>
                  <td>${item.d2}</td>
                  <td>${item.d3}</td>
                  <td>${item.d4}</td>
                  <td>${item.budget1}</td>
                  <td>${item.budget2}</td>
                `;
                this.tbody.appendChild(row);
              }, this);
            }
          }

          class FilterManager {
            constructor(data) {
              this.filters = [
                new Filter("filter-d1"),
                new Filter("filter-d2"),
                new Filter("filter-d3"),
                new Filter("filter-d4"),
              ];

              this.populateFilters(data);
              this.addEventListeners();
            }

            populateFilters(data) {
              const filterOptions = this.getFilterOptions(data);
              this.addOptionsToFilters(filterOptions);
            }

            getFilterOptions(data) {
              const filterOptions = [];

              for (let i = 1; i <= this.filters.length; i++) {
                const options = [...new Set(data.map((item) => item[`d${i}`]))];
                filterOptions.push(options);
              }

              return filterOptions;
            }

            addOptionsToFilters(filterOptions) {
              filterOptions.forEach((options, index) => {
                options.forEach((option) => {
                  this.filters[index].addOption(option);
                });
              });
            }

            addEventListeners() {
              this.filters.forEach((filter) => {
                filter.element.addEventListener("change", () => {
                  this.table.updateTable(this.data, this.filters);
                  this.updateFiltersWithRelevantValues();
                });
              });

              document
                .getElementById("reset-filters")
                .addEventListener("click", () => {
                  this.resetFilters();
                });
            }

            setTable(table) {
              this.table = table;
            }

            setData(data) {
              this.data = data;
            }

            updateFiltersWithRelevantValues() {
              const selectedFilters = this.filters.map((filter) =>
                filter.getSelectedOptions()
              );

              this.filters.forEach((filter, index) => {
                const relevantValues = this.getRelevantValues(
                  selectedFilters,
                  index
                );
                this.updateFilterOptions(filter, relevantValues);
              });
            }

            getRelevantValues(selectedFilters, currentIndex) {
              return this.data
                .filter((item) =>
                  selectedFilters.every((selectedOptions, index) => {
                    return (
                      index === currentIndex ||
                      selectedOptions.length === 0 ||
                      selectedOptions.includes(item[`d${index + 1}`])
                    );
                  })
                )
                .map((item) => item[`d${currentIndex + 1}`]);
            }

            updateFilterOptions(filter, relevantValues) {
              const allOptions = Array.from(filter.element.options);
              allOptions.forEach((option) => {
                option.disabled = !relevantValues.includes(option.value);
              });
            }

            resetFilters() {
              this.filters.forEach((filter) => {
                const allOptions = Array.from(filter.element.options);
                allOptions.forEach((option) => {
                  option.disabled = false;
                });
              });
            }
          }

          const table = new Table();
          const filterManager = new FilterManager(companyData);
          filterManager.setTable(table);
          filterManager.setData(companyData);
          table.updateTable(companyData, filterManager.filters);
        </script>
      </tbody>
    </table>
  </body>
</html>
