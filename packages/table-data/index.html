<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Table Data Component Example</title>
    <style>
      /* Add border to the table */
      table {
        border-collapse: collapse;
        width: 100%;
      }

      /* Add border to table cells */
      th,
      td {
        border: 1px solid black;
        padding: 8px;
      }

      /* Style the editable input */
      .editable-input {
        border: none;
        font-size: inherit;
        padding: 0;
        background-color: transparent;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <table>
      <tr>
        <th>Name</th>
        <th>Email</th>
      </tr>
      <tr>
        <td><table-data value="John Doe"></table-data></td>
        <td><table-data value="johndoe@example.com"></table-data></td>
      </tr>
    </table>

    <script>
      class TableData extends HTMLElement {
        constructor() {
          super();

          // Create a shadow root
          this.attachShadow({ mode: "open" });

          // Define the default value property
          this.value = "";
          this.isEditing = false;
          this.originalValue = "";

          // Bind event listeners
          this.handleDoubleClick = this.handleDoubleClick.bind(this);
          this.handleBlur = this.handleBlur.bind(this);
          this.handleKeyDown = this.handleKeyDown.bind(this);
        }

        static get observedAttributes() {
          return ["value"];
        }

        attributeChangedCallback(name, oldValue, newValue) {
          if (name === "value") {
            this.value = newValue;
          }
        }

        connectedCallback() {
          this.render();
          this.addEventListeners();
        }

        disconnectedCallback() {
          this.removeEventListeners();
        }

        addEventListeners() {
          this.addEventListener("dblclick", this.handleDoubleClick);
          this.addEventListener("blur", this.handleBlur);
          this.addEventListener("keydown", this.handleKeyDown);
        }

        removeEventListeners() {
          this.removeEventListener("dblclick", this.handleDoubleClick);
          this.removeEventListener("blur", this.handleBlur);
          this.removeEventListener("keydown", this.handleKeyDown);
        }

        handleDoubleClick() {
          if (!this.isEditing) {
            this.isEditing = true;
            this.originalValue = this.value;
            this.render();
          }
        }

        handleBlur() {
          if (this.isEditing) {
            this.isEditing = false;
            this.dispatchEvent(new CustomEvent("update", { detail: { originalValue: this.originalValue, newValue: this.value } }));
            this.render();
          }
        }

        handleKeyDown(event) {
          if (this.isEditing && (event.key === "Enter" || event.key === "Tab")) {
            event.preventDefault();
            this.blur();
          }
        }

        render() {
          const content = this.isEditing ? `<input class="editable-input" type="text" value="${this.value}">` : this.value;
          this.shadowRoot.innerHTML = `
          <style>
            /* Style the table data */
            td {
              padding: 8px;
              border: 1px solid black;
            }
          </style>
          <td>${content}</td>
        `;
        }
      }

      // Define the custom element
      customElements.define("table-data", TableData);
    </script>
  </body>
</html>
