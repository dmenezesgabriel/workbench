<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/codemirror.min.css" />
  </head>
  <body>
    <div id="tabs">
      <ul id="tab-header"></ul>
      <div id="tab-content"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/mode/javascript/javascript.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const editorContainer = document.getElementById("tab-content");
        const tabHeader = document.getElementById("tab-header");
        let currentEditor, currentTabId;
        let tabCount = 0;

        function createNewTab() {
          tabCount++;
          const tabId = `tab-${tabCount}`;
          const tab = document.createElement("li");
          tab.textContent = `Tab ${tabCount}`;
          tab.setAttribute("id", tabId);
          tabHeader.appendChild(tab);

          const newEditor = CodeMirror(editorContainer, {
            lineNumbers: true,
            mode: "javascript",
          });

          tab.addEventListener("click", () => {
            setCurrentEditor(newEditor, tabId);
          });

          setCurrentEditor(newEditor, tabId);
        }

        function setCurrentEditor(editor, tabId) {
          if (currentEditor) {
            currentEditor.getWrapperElement().style.display = "none";
          }

          currentEditor = editor;
          currentTabId = tabId;
          currentEditor.getWrapperElement().style.display = "block";
        }

        function saveEditorContent() {
          if (!currentEditor) return;

          const content = currentEditor.getValue();

          // Save content to IndexedDB (you'll need to set up IndexedDB functionality)
          // Replace 'your_db_name' and 'your_object_store_name' with your desired values
          const request = window.indexedDB.open("your_db_name");

          request.onsuccess = function (event) {
            const db = event.target.result;
            const transaction = db.transaction("your_object_store_name", "readwrite");
            const objectStore = transaction.objectStore("your_object_store_name");

            objectStore.put(content, currentTabId);
            console.log("Content saved to IndexedDB");
          };

          request.onerror = function (event) {
            console.error("Error opening IndexedDB", event.target.error);
          };
        }

        // Load saved content from IndexedDB
        function loadSavedContent() {
          // Replace 'your_db_name' and 'your_object_store_name' with your desired values
          const request = window.indexedDB.open("your_db_name");

          request.onsuccess = function (event) {
            const db = event.target.result;
            const transaction = db.transaction("your_object_store_name", "readonly");
            const objectStore = transaction.objectStore("your_object_store_name");

            const request = objectStore.get(currentTabId);

            request.onsuccess = function (event) {
              if (event.target.result) {
                currentEditor.setValue(event.target.result);
                console.log("Content loaded from IndexedDB");
              }
            };
          };

          request.onerror = function (event) {
            console.error("Error opening IndexedDB", event.target.error);
          };
        }

        // Create a new tab when the page loads
        createNewTab();

        // Add event listeners to buttons
        document.getElementById("new-tab-btn").addEventListener("click", createNewTab);
        document.getElementById("save-btn").addEventListener("click", saveEditorContent);
        document.getElementById("load-btn").addEventListener("click", loadSavedContent);
      });
    </script>
  </body>
</html>
